# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

PortGroup           active_variants 1.1
PortGroup           cmake 1.1
PortGroup           github 1.0

# tag_prefix will be changed to v starting with version 1.8.1
github.setup        coin3d simage 1.8.1 v
github.tarball_from releases

categories          graphics devel
platforms           darwin
revision            0
maintainers         nomaintainer
license             {public-domain permissive}
description         library for loading and saving images, sound and video

long_description    simage is a library capable of loading, manipulating \
                    and saving images, creating and saving movies (AVI and mpeg), and \
                    loading audio. The simage library relies heavily on 3rd party \
                    libraries to perform these tasks.

homepage            https://coin3d.github.io

distname            simage-${version}-src
distfiles           simage-${version}-src${extract.suffix}

checksums           rmd160  33ed0a29d77ecef1f1abe14da88e02a5ab5c3e99 \
                    sha256  a0b85ffa14cc03dcd5e4918dac8982a280df229f7e5758d1c28281920e9f8e74 \
                    size    829490

depends_lib         path:include/turbojpeg.h:libjpeg-turbo \
                    port:giflib \
                    port:libpng \
                    port:libsndfile \
                    port:tiff \
                    port:zlib

variant docs description {Include API documentation.} {
    depends_build-append    port:doxygen
    configure.args-append   -DSIMAGE_BUILD_DOCUMENTATION=ON
}

configure.args  -DSIMAGE_USE_QUICKTIME=OFF

# The QuickTime variant uses QuickTime for image loading, removing
# the dependencies on additional image libraries.
variant quicktime description {Use QuickTime instead of the many smaller libraries} {
    depends_lib-delete  path:include/turbojpeg.h:libjpeg-turbo \
                        port:giflib \
                        port:libpng \
                        port:tiff \
                        port:zlib

    configure.args-replace  -DSIMAGE_USE_QUICKTIME=OFF \
                            -DSIMAGE_USE_QUICKTIME=ON

    foreach arch [get_canonical_archs] {
        if {${arch} in {ppc64 x86_64}} {
            known_fail  yes
            depends_lib
            pre-configure {
                ui_error "The +quicktime variant cannot be used when building 64-bit"
                return -code error "incompatible arch"
            }
            break
        }
    }

    if {[vercmp ${macosx_sdk_version} 10.11] > 0} {
        known_fail  yes
        depends_lib
        pre-configure {
            ui_error "The +quicktime variant cannot be used with a macOS SDK later than 10.11"
            return -code error "incompatible macOS SDK"
        }
    }
}

github.livecheck.regex  {([0-9.]+)}
